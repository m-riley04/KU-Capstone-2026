# =============================================================================
# Polypod â€” Central Configuration
# /etc/polypod/polypod.conf
# =============================================================================
# This file is sourced by all Polypod scripts (sway config, deploy, update).
# Edit this to remap displays, change paths, or switch to fallback mode
# WITHOUT rebuilding the image.
# =============================================================================

# --- Display output mapping ---
# These must match the DRM connector names shown by: swaymsg -t get_outputs
#
# Typical values:
#   DSI-2       = Waveshare 3.5" DSI LCD (E)
#   SPI-1       = Waveshare 3.5" SPI LCD (G) via mipi-dbi-spi
#   HDMI-A-1    = HDMI port 0
#   HDMI-A-2    = HDMI port 1
POLYPOD_TOP_OUTPUT="DSI-2"
POLYPOD_BOTTOM_OUTPUT="SPI-1"

# --- Display resolutions ---
POLYPOD_TOP_RES="640x480"
POLYPOD_BOTTOM_RES="320x480"

# --- Display transforms (normal, 90, 180, 270, flipped, flipped-90, etc.) ---
POLYPOD_TOP_TRANSFORM="normal"
POLYPOD_BOTTOM_TRANSFORM="normal"

# --- Flutter app configuration ---
# The Polypod app is a SINGLE binary that takes a CLI argument to determine
# which window to show. Both processes communicate via IPC.
POLYPOD_APP_DIR="/opt/polypod"
POLYPOD_APP_BUNDLE="${POLYPOD_APP_DIR}/app"

# The binary name (matches the Flutter project name from pubspec.yaml).
POLYPOD_APP_BINARY="polypod_hw"

# CLI arguments passed to each process to select which window to display.
# Update these to match your app's actual argument format.
POLYPOD_TOP_ARGS="--window=top"
POLYPOD_BOTTOM_ARGS="--window=bottom"

# flutter-elinux embedder flags (screen size, etc.)
# These are passed to the embedder, NOT the Dart app.
POLYPOD_TOP_ELINUX_ARGS="--width=640 --height=480"
POLYPOD_BOTTOM_ELINUX_ARGS="--width=320 --height=480"

# --- Sway app_id handling ---
# flutter-elinux app_id defaults to the binary name. Since both windows
# use the same binary, they have the SAME app_id. Set this to "1" to use
# the IPC-based window placement strategy instead of Sway assign rules.
# If your app sets distinct app_ids per window, set to "0" and update below.
POLYPOD_SAME_APP_ID="1"
POLYPOD_TOP_APP_ID="polypod_hw"
POLYPOD_BOTTOM_APP_ID="polypod_hw"

# --- IPC socket for inter-process communication ---
POLYPOD_IPC_SOCKET="${POLYPOD_APP_DIR}/shared/polypod.sock"

# --- SPI fallback mode ---
# If Sway cannot manage the SPI display as a DRM output, set this to "1".
POLYPOD_SPI_FALLBACK="0"

# --- DRM devices ---
POLYPOD_SPI_DRM_DEVICE="/dev/dri/card0"
POLYPOD_MAIN_DRM_DEVICE="/dev/dri/card1"

# --- Remote update settings ---
POLYPOD_UPDATE_SERVER=""
POLYPOD_UPDATE_USER="deploy"
POLYPOD_UPDATE_PATH="/releases/latest"
POLYPOD_UPDATE_ENABLED="0"

# --- Watchdog ---
POLYPOD_WATCHDOG_SEC="30"

# --- Debug mode ---
POLYPOD_DEBUG="0"

# --- HDMI as DSI substitute (development mode) ---
# "1" = always use HDMI-A-1 for top window
# "auto" = auto-detect at boot (use HDMI if DSI absent)
POLYPOD_HDMI_DEV_MODE="0"
